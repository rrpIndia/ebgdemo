<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ================= PAGE LAYOUT CSS ================= -->
<style>
body {
  margin: 0;
}

.evm {
  display: flex;
  flex-direction: column; /* mobile */
  align-items: center;
  gap: 16px;
}

.svg-vvpat-wrapper {
  margin-top: 24px;
  display: flex;
  justify-content: center;
}

.svg-vvpat {
  width: 200px;
  max-width: 90vw;
}

.svg-ballot-unit-wrapper {
  display: flex;
  justify-content: center;
}

.svg-ballot-unit {
  width: 320px;
  max-width: 95vw;
}

.wire-layer {
  position: absolute;
  width: 100%;
  height: 100%;
  pointer-events: none;
}

#wire {
  fill: none;
  stroke: #f4c400;
  stroke-width: 8;
  stroke-linecap: round;
}
</style>
</head>

<body>

<div class="evm">

<!-- ================= WIRE ================= -->
<svg class="wire-layer" viewBox="0 0 400 600">
  <path id="wire"
    d="M 310 180
       C 310 180, 350 180, 355 180
       C 360 210, 360 240, 355 260
       C 330 270, 260 250, 200 260
       L 200 318"/>
</svg>

<!-- ================= VVPAT ================= -->
<div class="svg-vvpat-wrapper">
<svg xmlns="http://www.w3.org/2000/svg"
     viewBox="0 0 200 300"
     preserveAspectRatio="xMidYMin meet"
     class="svg-vvpat">

<style>
#vvpat-top {
  transform-origin: 0% 50%;
  transform-box: fill-box;
  transition: transform 0.9s ease;
}

#vvpat-top.open {
  transform: perspective(800px) rotateY(-120deg);
}

#vvpat-inner-face {
  transition: opacity 0.4s ease;
  opacity: 0;
}

#vvpat-top.open #vvpat-inner-face {
  opacity: 1;
}

#vvpat-inner-shadow {
  transition: opacity 0.5s ease;
  opacity: 0;
}
#vvpat-slip {
  transition: opacity 0.6s ease, filter 0.6s ease;
}

#vvpat-top.open ~ #vvpat-slip {
  filter: drop-shadow(0 4px 6px rgba(0,0,0,0.25));
}
</style>

<!-- Hinges -->
<g>
  <rect x="-6" y="40" width="6" height="24" rx="2" fill="#999"/>
  <circle cx="-3" cy="52" r="2" fill="#666"/>

  <rect x="-6" y="170" width="6" height="24" rx="2" fill="#999"/>
  <circle cx="-3" cy="182" r="2" fill="#666"/>
</g>

<rect id="vvpat-inner-shadow"
      x="0" y="0"
      width="200" height="240"
      rx="6"
      fill="black"/>
<!-- Fixed VVPAT base (always visible) -->
<rect
  x="0" y="0"
  width="200" height="240"
  rx="6"
  fill="#d0d0d0"
  stroke="#aaa"/>

<!--=======start of lid========-->
<g id="vvpat-top">
  <rect x="0" y="0" 
	width="200"
	height="240"
        rx="6"
	fill="#e6e6e6"
	stroke="#aaa"/>

  <rect id="vvpat-inner-face"
        x="4" y="4"
        width="192" height="232"
        rx="4"
        fill="#e6e6e6"/>

  <rect x="0" y="0" 
	width="6"
	height="240"
        fill="#b5b5b5"/>

  <rect x="40" y="30"
	width="120" 
	height="80"
        fill="black"/>
  
  <text x="100" y="230"
      text-anchor="middle"
      font-size="18"
      font-weight="bold">
	MOCK VVPAT
  </text>
</g>
<!--========end of lid========-->

<!-- VVPAT Slip -->
<g id="vvpat-slip" opacity="0">
  <rect x="41" y="31"
        width="118" height="78"
        fill="white"
  	stroke="#ccc"/>
  <text id="vvpat-slip-text"
        x="100" y="75"
        text-anchor="middle"
        dominant-baseline="middle"
        font-size="42"></text>
</g>

</svg>
</div>

<button onclick="toggleVVPAT()">Open / Close VVPAT</button>

<!-- ================= BALLOT UNIT ================= -->
<div class="svg-ballot-unit-wrapper">
<svg xmlns="http://www.w3.org/2000/svg"
     viewBox="0 0 600 720"
     class="svg-ballot-unit">

<style>
.BallotUnitBody {
  fill: gainsboro;
  stroke: #b5b5b5;
  stroke-width: 2;
}

.BallotUnitHeader {
  fill: lightgray;
  stroke: darkgray;
}

.BallotUnitNamePanel {
  fill: white;
  stroke: #ccc;
}

.BallotUnitButton {
  fill: #d9d9d9;
  stroke: #999;
  cursor: pointer;
}

.led {
  fill: dimgray;
}

.led.on {
  fill: green;
  filter: drop-shadow(0 0 6px #00ff00);
}
</style>

<g transform="translate(130,10)">
  <rect x="0" y="0" width="340" height="550" rx="18"
        class="BallotUnitBody"/>

  <rect x="10" y="10" width="320" height="60" rx="8"
        class="BallotUnitHeader"/>

  <!-- SVG has no parent-child layout.
       Center must be calculated manually -->
  <text x="170" y="40"
        text-anchor="middle"
        dominant-baseline="middle"
        font-size="24"
        font-weight="bold">
MOCK VOTING MACHINE
  </text>

  <g transform="translate(0,100)">
    <g>
      <rect x="20" y="0" width="220" height="44"
            class="BallotUnitNamePanel"/>
      <text x="30" y="28" font-size="24" font-weight="bold">
Apple üçé
      </text>
      <circle id="led-1" cx="250" cy="22" r="6" class="led"/>
      <rect x="270" y="4" width="60" height="36" rx="6"
            class="BallotUnitButton"
            onclick="vote(1)"/>
    </g>

    <g transform="translate(0,60)">
      <rect x="20" y="0" width="220" height="44"
            class="BallotUnitNamePanel"/>
      <text x="30" y="28" font-size="24" font-weight="bold">
Banana üçå
      </text>
      <circle id="led-2" cx="250" cy="22" r="6" class="led"/>
      <rect x="270" y="4" width="60" height="36" rx="6"
            class="BallotUnitButton"
            onclick="vote(2)"/>
    </g>
  </g>
</g>
</svg>
</div>

</div>

<!-- ================= APPLICATION LOGIC ================= -->
<script>
let isLocked = false;
let unlockTimer = null;
let vvpatOpen = false;
let lastVotedCandidate = null;
let artificialLightOn = false;

function updateSlipVisibility() {
  const slip = document.getElementById('vvpat-slip');

  // visible if natural OR artificial light
  if (vvpatOpen || artificialLightOn) {
    slip.style.opacity = 1;
  } else {
    slip.style.opacity = 0;
  }
}

function acquireLock() {
  if (isLocked) return false;
  isLocked = true;
  return true;
}

function releaseLock() {
  isLocked = false;
  console.log('Machine unlocked');
}

function activateLED(n) {
  document.querySelectorAll('.led')
    .forEach(l => l.classList.remove('on'));
  document.getElementById('led-' + n)
    .classList.add('on');
}

function showVVPAT(n) {
  const text = document.getElementById('vvpat-slip-text');

  lastVotedCandidate = (n === 1) ? 'üçé' : 'üçå';
  text.textContent = lastVotedCandidate;

  artificialLightOn = true;   // internal lamp ON
  updateSlipVisibility();
}

function resetLED(n) {
  document.getElementById('led-' + n).classList.remove('on');
}

function vote(n) {
  if (!acquireLock()) return;

  if (unlockTimer) clearTimeout(unlockTimer);

  activateLED(n);
  showVVPAT(n);

  // turn OFF artificial light after 7 seconds
  setTimeout(() => {
    artificialLightOn = false;
    updateSlipVisibility();
  }, 7000);

  unlockTimer = setTimeout(releaseLock, 7000);
}

function toggleVVPAT() {
  const top = document.getElementById('vvpat-top');

  vvpatOpen = !vvpatOpen;
  top.classList.toggle('open', vvpatOpen);

  updateSlipVisibility();
}
</script>

</body>
</html>
